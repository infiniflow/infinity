
statement ok
DROP TABLE IF EXISTS tensor_array_maxsim;

statement ok
CREATE TABLE tensor_array_maxsim (c1 int, c2 TensorArray(float,8));

statement ok
COPY tensor_array_maxsim FROM '/var/infinity/test_data/tensor_array_float_dim8.csv' WITH (DELIMITER ',', FORMAT CSV);

query I
SELECT * FROM tensor_array_maxsim;
----
2 [[[0.1,0.2,0.3,0,0.3,0,0.2,0.3]]]
4 [[[0.2,0.1,0.3,0.4,0,0.3,0.2,0.1]],[[0,0.2,0,0,0.3,0,0.2,0.3]]]
6 [[[0.3,0.2,0.1,0.4,0.4,0.3,0.2,0],[0.1,0,9.4,0.3,0.3,0.2,0.1,0.4]],[[0.4,0.3,0.2,0,0.1,0,9.4,0.3]]]
8 [[[0.4,0,0.2,0.1,0,0.3,0.2,0.1]]]

# default top 10
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [0.0, -10.0, 0.0, 0.7, 9.2, 45.6, -55.8, 3.5], 'float', 'maxsim', '');
----
6 7.910000
8 2.940000
4 2.150000
2 -9.350000

# default top 10
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [5, -10, 0, 0, 0, 0, 11, 0], 'double', 'maxsim', '');
----
6 102.400000
8 4.200000
4 2.200000
2 0.700000

query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [1, 0, 0, 0, 0, 0, 0, 1], 'float16', 'maxsim', '');
----
6 0.700000
8 0.500000
2 0.400000
4 0.300000

# default top 10
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [[5, -10, 0, 0, 0, 0, 11, 0],[1, 0, 0, 0, 0, 0, 0, 1]], 'bfloat16', 'maxsim', '');
----
6 103.100000
8 4.700000
4 2.500000
2 1.100000

# option top 2
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [1, 0, 0, 0, 0, 0, 0, 1], 'bfloat16', 'maxsim', 'topn=2');
----
6 0.700000
8 0.500000

# Cleanup
statement ok
DROP TABLE tensor_array_maxsim;

statement ok
CREATE TABLE tensor_array_maxsim (c1 int, c2 TensorArray(float16,8));

statement ok
COPY tensor_array_maxsim FROM '/var/infinity/test_data/tensor_array_float_dim8.csv' WITH (DELIMITER ',', FORMAT CSV);

# default top 10
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [0.0, -10.0, 0.0, 0.7, 9.2, 45.6, -55.8, 3.5], 'float', 'maxsim', '');
----
6 7.909300
8 2.944800
4 2.155000
2 -9.346200

# default top 10
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [5, -10, 0, 0, 0, 0, 11, 0], 'double', 'maxsim', '');
----
6 102.381800
8 4.199000
4 2.199500
2 0.699800

query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [1, 0, 0, 0, 0, 0, 0, 1], 'float16', 'maxsim', '');
----
6 0.700000
8 0.499900
2 0.400000
4 0.300000

# default top 10
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [[5, -10, 0, 0, 0, 0, 11, 0],[1, 0, 0, 0, 0, 0, 0, 1]], 'bfloat16', 'maxsim', '');
----
6 103.081800
8 4.698900
4 2.499400
2 1.099900

# option top 2
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [1, 0, 0, 0, 0, 0, 0, 1], 'bfloat16', 'maxsim', 'topn=2');
----
6 0.700000
8 0.499900

# Cleanup
statement ok
DROP TABLE tensor_array_maxsim;

statement ok
CREATE TABLE tensor_array_maxsim (c1 int, c2 TensorArray(bfloat16,8));

statement ok
COPY tensor_array_maxsim FROM '/var/infinity/test_data/tensor_array_float_dim8.csv' WITH (DELIMITER ',', FORMAT CSV);

# default top 10
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [0.0, -10.0, 0.0, 0.7, 9.2, 45.6, -55.8, 3.5], 'float', 'maxsim', '');
----
6 7.879100
8 2.928500
4 2.141600
2 -9.313500

# default top 10
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [5, -10, 0, 0, 0, 0, 11, 0], 'double', 'maxsim', '');
----
6 102.128900
8 4.183600
4 2.191400
2 0.697300

query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [1, 0, 0, 0, 0, 0, 0, 1], 'float16', 'maxsim', '');
----
6 0.697300
8 0.498000
2 0.398400
4 0.298800

# default top 10
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [[5, -10, 0, 0, 0, 0, 11, 0],[1, 0, 0, 0, 0, 0, 0, 1]], 'bfloat16', 'maxsim', '');
----
6 102.826200
8 4.681600
4 2.490200
2 1.095700

# option top 2
query IR
SELECT c1, ROUND(SCORE(), 4) FROM tensor_array_maxsim SEARCH MATCH TENSOR (c2, [1, 0, 0, 0, 0, 0, 0, 1], 'bfloat16', 'maxsim', 'topn=2');
----
6 0.697300
8 0.498000

# Cleanup
statement ok
DROP TABLE tensor_array_maxsim;
