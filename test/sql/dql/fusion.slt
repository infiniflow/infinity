# name: test/sql/dql/fusion.slt
# description: Test fulltext + knn + fusion search
# group: [dql]
# refers to: fulltext.slt, test_knn_ip.slt

statement ok
DROP TABLE IF EXISTS enwiki_embedding;

statement ok
CREATE TABLE enwiki_embedding(doctitle varchar, docdate varchar, body varchar, num INT, vec EMBEDDING(FLOAT, 4));

# copy data from csv file
query I
COPY enwiki_embedding FROM '/tmp/infinity/test_data/enwiki_embedding_9999.csv' WITH ( DELIMITER '\t' );
----

statement ok
CREATE INDEX ft_index ON enwiki_embedding(body) USING FULLTEXT WITH(ANALYZER=segmentation) (doctitle, docdate) USING FULLTEXT;

query TTT
SELECT doctitle, docdate, body, num FROM enwiki_embedding SEARCH MATCH('doctitle^2,body^5', 'harmful chemical', 'topn=3'), KNN(vec, [0.3, 0.3, 0.2, 0.2], 'float', 'ip', 3), FUSION('rrf');
----


# Clean up
statement ok
DROP TABLE enwiki_embedding;


